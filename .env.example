# =============================================================================
# NocoDB - Environment Configuration
# =============================================================================
# Documentation: https://docs.nocodb.com/getting-started/self-hosted/environment-variables/
# =============================================================================

# -----------------------------------------------------------------------------
# Stack Configuration
# -----------------------------------------------------------------------------

# Unique stack name (used for container names, volumes, networks)
STACK_NAME=db_example_app_domain_com

# Timezone (https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
TIME_ZONE=Etc/UTC

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------

# PostgreSQL password (REQUIRED - change this!)
# Generate: openssl rand -base64 16
DATABASE_PASSWORD=CHANGE_ME_SECURE_PASSWORD

# PostgreSQL version (optional, default: 18)
# POSTGRES_VERSION=18

# -----------------------------------------------------------------------------
# Connection Pool Settings
# -----------------------------------------------------------------------------
# NocoDB und PostgreSQL haben separate Pool-Einstellungen.
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ VERBINDUNGS-ARCHITEKTUR                                                     │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │                                                                             │
# │  NocoDB App ─────► Knex.js Pool ─────► PostgreSQL                           │
# │                    (DB_MAX_POOL_SIZE)  (DATABASE_POOLMAXSIZE)               │
# │                                                                             │
# │  Formel: DATABASE_POOLMAXSIZE = DB_MAX_POOL_SIZE + 20%                      │
# │          (Reserve für Admin, Backups, Monitoring)                           │
# │                                                                             │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# ┌─────────────────────────────────┬───────────┬───────────┬───────────────────┐
# │ Einstellung                     │ Klein     │ Mittel    │ Produktion        │
# │                                 │ (Dev)     │ (5-20 User)│ (20+ User)       │
# ├─────────────────────────────────┼───────────┼───────────┼───────────────────┤
# │ DB_MAX_POOL_SIZE                │ 10        │ 25        │ 50                │
# │ DATABASE_POOLMAXSIZE (+20%)     │ 12        │ 30        │ 60                │
# └─────────────────────────────────┴───────────┴───────────┴───────────────────┘
#
# DB_MAX_POOL_SIZE: NocoDB Knex.js Pool (min: 1, max: 100, default: 10)
# Quelle: https://github.com/nocodb/nocodb/pull/9974

# NocoDB Connection Pool (API-optimiert)
DB_MAX_POOL_SIZE=45

# PostgreSQL max_connections (DB_MAX_POOL_SIZE + Reserve)
DATABASE_POOLMAXSIZE=50

# -----------------------------------------------------------------------------
# PostgreSQL Performance Tuning
# -----------------------------------------------------------------------------
# Alle Werte haben sinnvolle Standardwerte im Compose-File.
# Nur bei Bedarf anpassen und auskommentieren.
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ STORAGE I/O SETTINGS                                                        │
# │ (PostgreSQL: random_page_cost, effective_io_concurrency)                    │
# ├─────────────────────────────────┬───────────────────────────────────────────┤
# │ ENV Variable                    │ SSD/NVMe    │ HDD 10k    │ HDD 7.2k      │
# │                                 │ (default)   │ RPM        │ RPM           │
# ├─────────────────────────────────┼─────────────┼────────────┼───────────────┤
# │ PG_RANDOM_PAGE_COST             │ 1.1         │ 2.0        │ 4.0           │
# │ PG_EFFECTIVE_IO_CONCURRENCY     │ 200         │ 4          │ 2             │
# └─────────────────────────────────┴─────────────┴────────────┴───────────────┘
#
# PG_RANDOM_PAGE_COST=1.1
# PG_EFFECTIVE_IO_CONCURRENCY=200
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ MEMORY SETTINGS                                                             │
# │ (PostgreSQL: shared_buffers, effective_cache_size, work_mem,                │
# │              maintenance_work_mem)                                          │
# ├─────────────────────────────────┬───────────┬───────────┬─────────┬─────────┤
# │ ENV Variable                    │ 4 GB RAM  │ 8 GB RAM  │ 16 GB   │ 32 GB   │
# ├─────────────────────────────────┼───────────┼───────────┼─────────┼─────────┤
# │ PG_SHARED_BUFFERS               │ 1GB       │ 2GB       │ 4GB     │ 8GB     │
# │ PG_EFFECTIVE_CACHE_SIZE         │ 3GB       │ 6GB       │ 12GB    │ 24GB    │
# │ PG_WORK_MEM                     │ 4MB       │ 8MB       │ 16MB    │ 32MB    │
# │ PG_MAINTENANCE_WORK_MEM         │ 128MB     │ 256MB     │ 512MB   │ 1GB     │
# └─────────────────────────────────┴───────────┴───────────┴─────────┴─────────┘
#
# PG_SHARED_BUFFERS=2GB
# PG_EFFECTIVE_CACHE_SIZE=4GB
# PG_WORK_MEM=8MB
# PG_MAINTENANCE_WORK_MEM=256MB
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ WAL SETTINGS (Write-Ahead Log)                                              │
# │ (PostgreSQL: max_wal_size, min_wal_size)                                    │
# ├─────────────────────────────────┬───────────┬───────────┬─────────┬─────────┤
# │ ENV Variable                    │ 4 GB RAM  │ 8 GB RAM  │ 16 GB   │ 32 GB   │
# ├─────────────────────────────────┼───────────┼───────────┼─────────┼─────────┤
# │ PG_MAX_WAL_SIZE                 │ 1GB       │ 2GB       │ 4GB     │ 8GB     │
# │ PG_MIN_WAL_SIZE                 │ 256MB     │ 512MB     │ 1GB     │ 2GB     │
# └─────────────────────────────────┴───────────┴───────────┴─────────┴─────────┘
#
# PG_MAX_WAL_SIZE=2GB
# PG_MIN_WAL_SIZE=512MB

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------

# Private subnet for internal network
# Creates: 10.67.X.0/24 (IPv4) and fdfd:10:67:X::/64 (IPv6)
# Use unique value per stack (1-254)
PRIVATESUBNET=254

# -----------------------------------------------------------------------------
# Local Mode (docker-compose.local.yml)
# -----------------------------------------------------------------------------

# Direct port binding
# Examples: 8080, 192.168.1.100:8080, 127.0.0.1:8080
EXPOSED_APP_PORT=8080

# -----------------------------------------------------------------------------
# Traefik Configuration (all traefik compose files)
# -----------------------------------------------------------------------------

# Hostname - DNS must resolve to Traefik host
SERVICE_HOSTNAME=db.example.app.domain.com

# External Traefik network name
PROXY_NETWORK=EDGEPROXY

# -----------------------------------------------------------------------------
# Traefik Local Mode (docker-compose.traefik-local.yml)
# -----------------------------------------------------------------------------

# Allowed IP ranges (comma-separated CIDR notation)
# Common ranges:
#   127.0.0.1/32      - Localhost IPv4
#   ::1/128           - Localhost IPv6
#   192.168.0.0/16    - Private IPv4
#   10.0.0.0/8        - Private IPv4
#   fd00::/8          - Private IPv6 (ULA)
IP_WHITELIST=127.0.0.1/32,::1/128,192.168.0.0/16,fd88::/48

# -----------------------------------------------------------------------------
# Traefik Header Auth Mode (docker-compose.traefik-header-auth.yml)
# -----------------------------------------------------------------------------

# Secret for X-BAUERGROUP-Auth header
# Generate: uuidgen or openssl rand -hex 16
HEADER_AUTH_SECRET=00000000-0000-0000-0000-000000000000

# -----------------------------------------------------------------------------
# SMTP Configuration
# -----------------------------------------------------------------------------

SMTP_HOST=smtp.example.com
SMTP_PORT=465
SMTP_TLS=true
SMTP_CERTCHECK=true
SMTP_FROM_NAME=Database - Example
SMTP_FROM=no-reply@example.com
SMTP_USER=
SMTP_PASSWORD=

# -----------------------------------------------------------------------------
# NocoDB Application Settings
# -----------------------------------------------------------------------------

# Attachment size limit in bytes (default: 256 MB = 262144000)
# NC_ATTACHMENT_FIELD_SIZE=262144000

# Maximum attachments per field (default: 50)
# NC_MAX_ATTACHMENTS_ALLOWED=50

# Secure attachments (pre-signed URLs only)
# NC_SECURE_ATTACHMENTS=false
# NC_ATTACHMENT_EXPIRE_SECONDS=7200

# -----------------------------------------------------------------------------
# S3/MinIO Storage (optional)
# -----------------------------------------------------------------------------

# Uncomment to enable S3-compatible storage for attachments
# NC_S3_BUCKET_NAME=nocodb-bucket
# NC_S3_REGION=us-east-1
# NC_S3_ENDPOINT=https://s3.example.com
# NC_S3_ACCESS_KEY=
# NC_S3_ACCESS_SECRET=
# NC_S3_FORCE_PATH_STYLE=true
# NC_S3_ACL=private

# =============================================================================
# Deployment
# =============================================================================
#
# Local Mode (direct port access):
#   docker compose -f docker-compose.local.yml up -d
#   Access: http://localhost:${EXPOSED_APP_PORT}
#
# Traefik HTTPS (production):
#   docker compose -f docker-compose.traefik.yml up -d
#   Access: https://${SERVICE_HOSTNAME}
#
# Traefik HTTP + IP-Whitelist (internal network):
#   docker compose -f docker-compose.traefik-local.yml up -d
#   Access: http://${SERVICE_HOSTNAME}
#
# Traefik HTTPS + Header Auth (protected):
#   docker compose -f docker-compose.traefik-header-auth.yml up -d
#   Access: https://${SERVICE_HOSTNAME}
#   Header: X-BAUERGROUP-Auth: ${HEADER_AUTH_SECRET}
#
# =============================================================================
# PostgreSQL Upgrade Notes
# =============================================================================
#
# For upgrading PostgreSQL (e.g., 15 to 18):
#   See pg_upgrade_inplace.sh in Shared/Scripts folder
#
# =============================================================================
